# 翻译@Auto Layout Guide（自动布局指南）

- 原文：[Auto Layout Guide](https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/AutolayoutPG/index.html#//apple_ref/doc/uid/TP40010853)
- 作者：[Apple](https://developer.apple.com/library/content/navigation/)

---

## Auto Layout Cookbook（自动布局使用手册）

### Simple Constraints（简单约束）

下述实例通过简单约束实现常见效果，是复杂布局的基础。

查看下述实例的源代码，详见项目[Auto Layout Cookbook](https://developer.apple.com/sample-code/xcode/downloads/Auto-Layout-Cookbook.zip)。

#### Simple Single View（单个简单视图）

本例中，红色视图填充父视图，但与其四边留有间距。

[图31]()

##### Views and Constraints（视图和约束）

将一个视图拖拽至画布，缩放大小，使其填满整个根视图。根据系统建议摆放视图（即视图在画布上移动时出现的蓝色虚线），可以快速对齐。

>注意
>
>视图位置不必精确到像素级别，因为添加约束后，系统会自动更新位置和尺寸。

视图就位后，按照下图添加约束：

[图32]()

```s
Red View.Leading = Superview.LeadingMargin
Red View.Trailing = Superview.TrailingMargin
Red View.Top = Top Layout Guide.Bottom + 20.0
Bottom Layout Guide.Top = Red View.Bottom + 20.0

```

##### Attributes（属性）

将视图背景颜色设置为红色，打开属性面板，按照如下设置：

View | Attribute | Value
------------- | ------------- | -------------
Red View | Background | Red

##### Discussion（讨论）

例子中的约束固定红色视图到父视图四边的距离。对于前后来说，相对父视图的留白约束；对于上下来说，相对控制器的布局参照约束。

>注意
>
>根视图的留白由系统决定，前后一般为16或20pt（根据设备不同），上下为0pt。这样，根视图的内容会位于栏位下方（UIKit Bar：状态栏，导航栏，标签栏，工具栏等）。
>
>然而，本例中所需展示的内容（红色视图）需要位于上下栏位之间（如有）。所以，前后可以相当父视图的留白约束，而上下必须相当控制器的布局参照约束。

子视图与父视图之间的默认间距是20pt；子视图与子视图之间的默认间距是8pt。这意味着红色视图与状态栏之间的距离应为8pt；然而，设备横屏时，状态栏会随之消失，此时8pt的间距就显得太窄了。

根据具体情况选择最合适的布局。本例中红色视图的上下间距都是20pt。这样做一来保证了约束尽可能简单；同时无论哪种设备方向，都有合理的显示效果。当然，其他情况下8pt的效果可能更好。

要创造根据栏位存在与否自动变化的布局，详见章节[Adaptive Single View](https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/AutolayoutPG/WorkingwithSimpleConstraints.html#//apple_ref/doc/uid/TP40010853-CH12-SW4)。

#### Adaptive Single View（单个自适应视图）

本例布局一个蓝色视图，让其填充父视图，四周留有间距。与单一简单视图不同，蓝色视图上方的间距会根据显示环境变化。如果状态栏可见，则间距为标准的8pt（蓝色视图与状态栏之间）；如果状态栏不可见，则间距为20pt（蓝色视图与父视图之间）。

![图33]()

对比本例与上例，可以看出明显区别。

![图34]()

##### Views and Constraints（视图和约束）

向画布中拖拽一个视图，调整大小，填充整个根视图，但四周与IB推荐的位置对齐。然后按照下图添加约束：

![图35]()

```s
Blue View.Leading = Superview.LeadingMargin
Blue View.Trailing = Superview.TrailingMargin
Blue View.Top = Top Layout Guide.Bottom + Standard (Priority 750)
Blue View.Top >= Superview.Top + 20.0
Bottom Layout Guide.Top = Blue View.Bottom + Standard (Priority 750)
Superview.Bottom >= Blue View.Bottom + 20.0

```

##### Attributes（属性）

还需要将视图背景颜色设置为蓝色，打开属性面板，按照如下设置：

View | Attribute | Value
------------- | ------------- | -------------
Blue View | Background | Blue

##### Discussion（讨论）

本例为蓝色视图创建动态的上下边距。如果有栏位，则间距为8pt。如果没有，则间距为20pt。

本例中的布局使用了控制器的布局参照。系统根据栏位是否存在，以及存在情况下栏位的高度，配置布局参照。上方布局参照代表所有上方栏位的最下沿（例如，状态栏和导航栏同时出现时，以导航栏的下沿为准）。下方布局参照代表下方栏位的上沿（例如，标签栏）。如果没有栏位，则布局参照代表相应的父视图的边缘。

本例将两种约束组合，实现自适应行为。第一种是必要的，大于等于约束。这个约束确保蓝色视图的距离父视图至少有20的距离。事实上，等同于定义了最小间距为20pt。

第二种是可选约束，其规定蓝色视图距离控制器的布局参照有8pt的距离。由于这个约束是可选的，即使无法完全满足，也会尽量满足。所以这个约束就像一个弹簧一样，将蓝色视图拉近布局参照。

如果不显示栏位，布局参照等同于父视图的边缘。蓝色视图无法同时满足8pt和20pt的间距。因此系统会略过可选约束，改为尽量满足——将间距设置为20pt。

如果栏位存在，则两个约束都得以满足。所有栏位都至少20pt高。所以如果系统将视图与栏位的间距设置为8，则视图距离父视图的距离肯定大于20pt。

这种使用一对互斥约束，实现效果的方法，是创建自适应布局的常见手段。我们在讲解内缩和外扩属性的相关章节[Views with Intrinsic Content Size（使用故固有尺寸的视图）](https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/AutolayoutPG/ViewswithIntrinsicContentSize.html#//apple_ref/doc/uid/TP40010853-CH13-SW1)时，会再次用到。