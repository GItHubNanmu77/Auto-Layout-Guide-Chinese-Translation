# 翻译@Auto Layout Guide（自动布局指南）

- 原文：[Auto Layout Guide](https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/AutolayoutPG/index.html#//apple_ref/doc/uid/TP40010853)
- 作者：[Apple](https://developer.apple.com/library/content/navigation/)

---

## Getting Started（新手上路）

### Working with Constraints in Interface Builder（在界面编辑器中使用约束）

在界面编辑器中创建约束，有三种方式：按住control拖拽视图，创建约束；使用固定和对齐工具（Pin and Align tools）生成约束；使用界面编辑器自动设置的约束，然后根据需要修改。这些方式各有优缺点。大多数开发者会选择一种自己偏爱的方式，但全部熟悉能够让我们更好的根据需求选择合适的方式。

不管使用哪种方式，都要先从对象库中拖拽视图和控件到画布。根据需要调整它们的大小和位置，这时，界面编辑器会创建一组隐性约束，定义视图的当前尺寸以及相对于父视图左上角的位置。

编译并运行app，可以迅速查看界面原型。但随着开发的进行，需要为视图添加显性约束。绝对不要发布使用隐形约束的app。

为视图添加第一条自定义约束后，系统会自动移除所有相关的隐性约束。此时，由于缺少约束，视图的尺寸和位置无法被正确定义，布局出现歧义。受影响的约束会显示为红色，Xcode会报警告。

别慌。继续添加约束，直至布局完成。一旦我们开始添加约束，就必须创建一个明确，可满足的布局。

更多关于修复布局警告和错误的信息，详见[调试自动布局](https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/AutolayoutPG/TypesofErrors.html#//apple_ref/doc/uid/TP40010853-CH22-SW1)。

#### Control-Dragging Constraints（拖拽约束）

要在两个视图之间创建约束，按住control，将一个视图拖动至另一个。

![图12](http://ohqrsnfvu.bkt.clouddn.com/auto-layout-guide/%E5%9B%BE12.png)

随后松开鼠标，会弹出一个灰色菜单，从中选择一个要添加的约束。

![图13](http://ohqrsnfvu.bkt.clouddn.com/auto-layout-guide/%E5%9B%BE13.png)

界面编辑器能够根据参与约束的元素（视图）以及拖拽的方向，给出一组可供选择的约束。如果沿水平方向拖拽，则可供选择的约束包括视图间的水平距离，以及垂直对齐两个视图。如果沿垂直方向拖拽，则可供选择的约束包括视图间的垂直距离，以及水平对齐两个视图。此外，还有一系列其他可用约束（例如设置相对尺寸）。

>注意
>
>拖拽的对象可以是画布上的视图，也可以是场景对象列表（scene document outline）。后者特别适用于为在画布上找不到的对象添加约束，例如上方或下方布局参照（layout guide）。当向场景对象列表中的对象拖拽时，可用的约束不再受拖拽方向影响。

界面编辑器根据视图当前的frame创建约束。因此，添加约束前，要将视图移动到合适的位置。只要组合得当，最终获得约束能够符合预期。而且，约束创建后随时都可以进行修改。

通过拖拽，我们可以迅速添加约束；然而，由于约束的值是根据视图当前frame推断而来的，很容易产生偏差。想要更精确的控制布局，约束创建后我们需要逐一检查，也可以使用固定和对齐工具。

等多关于拖拽创建约束的信息，详见自动布局帮助中同拖拽创建约束有关的内容。

#### Using the Stack, Align, Pin and Resolve Tools（使用堆叠，对齐，固定和问题解决工具）

界面编辑器在编辑窗口右下角提供了四个布局工具。它们分别是堆叠，对齐，固定和问题解决工具。

![图14](http://ohqrsnfvu.bkt.clouddn.com/auto-layout-guide/%E5%9B%BE14.png)

如果想要更精确的创建约束，或一次创建多个约束，可以使用固定和对齐工具。一个额外的好处是，使用这些工具创建约束，不需要提前布置视图。相反，只需要将视图移动至大致位置，添加约束，最后更新frame即可。自动布局会自动更新画布上视图的位置和尺寸。

##### Stack Tool(堆叠工具)

使用堆叠工具能够快速创建堆叠视图。选中画布上一个或多个视图，然后点击堆叠工具。界面编辑器会将选中的视图嵌入堆叠视图中，根据内容调整堆叠视图的尺寸。

>注意
>
>系统会根据内容视图间的相对位置决定堆叠视图的初始方向和对齐方式。你可以在属性面板修改其方向，对齐方式，分布方式以及子视图间距。


##### Align Tool（对齐工具）

对齐工具可以快速对齐画布上的视图。选中想要对齐的视图，点击对齐工具。界面编辑器会弹出一个菜单，包括所有可能的对齐方式。

![图15](http://ohqrsnfvu.bkt.clouddn.com/auto-layout-guide/%E5%9B%BE15.png)

选中一个对齐方式，然后点击添加约束。界面编辑器会为视图添加相应的对齐约束。默认，对齐约束不包含任何偏移量（四边或中心直接对齐），视图在画布上的尺寸和位置也不会自动更新。添加约束后，我们可以手动进一步修改。

使用对齐工具时，一般选择两个以上视图。然而，容器内水平对齐（Horizontally in Container）或容器内垂直对齐（Vertically in Container）可以针对单个视图添加。弹窗中的对齐方式可以多选，即一次添加多个对齐约束，但我们很少需要这样做。

更多信息，详见自动布局帮助中使用固定和对齐工具添加约束的相关内容。

##### Pin Tool（固定工具）

固定工具能够快速设定视图的相对位置和尺寸。选中想要固定的视图，点击固定工具。界面编辑器会弹出菜单，包含可能的选项。

![图16](http://ohqrsnfvu.bkt.clouddn.com/auto-layout-guide/%E5%9B%BE16.png)

菜单的上半部分允许我们相对当前视图的四周的邻近视图固定其前部，上部，后部和下部。四个数字分别代表当前frame下四边和邻近视图的距离；可以修改这些数字，也可以点击后面的三角形，选择要参照的视图，以及系统推荐的标准间距。"相对边距布局（Constrain to margins）"的选项表示相对父视图布局时，是否保留边距。（译者：例如，相对父视图的leading布局时，如不勾选，则相对于superView.Leading，勾选，相对于superView.Leading.Margin。）

![图17](http://ohqrsnfvu.bkt.clouddn.com/auto-layout-guide/%E5%9B%BE17.png)

菜单的下半部分允许我们设置视图的宽度和高度。宽度和高度默认同当前frame一致，当然也可输入其他值。针对宽高比添加约束的选项（Aspect Ratio），默认使用视图当前的宽高比，可以在添加约束之后修改。

通常，我们一次选中一个视图来固定。然而，如果选中两个或以上的视图，可以设置它们等高或等宽。一次创建多个约束也是可以的，视图的在画布上的frame会自动更新。确定了要添加的约束后，点击添加约束按钮即可。

更多信息，详见自动布局帮助中使用固定和对齐工具添加约束的相关内容。

##### Resolve Auto Layout Issues Tool（问题解决工具）

问题解决工具可以为常见的布局问题提供可能的解决方案。上半部分的解决方案只影响选中的视图，下半部分的方案将影响场景中的所有视图。

![图18](http://ohqrsnfvu.bkt.clouddn.com/auto-layout-guide/%E5%9B%BE18.png)

通过这个工具，我们可以根据视图的约束更新其frame；也可以根据视图的frame更新其约束。还可以添加缺失的约束，清除约束，或者干脆重置视图，添加系统推荐的约束。

添加和重置约束的命令在章节：[让界面编辑器替我们创建约束]()中有更详细的讨论。

#### Letting Interface Builder Create Constraints（让界面编辑器替我们创建约束）

界面编辑器可以替我们创建部分，甚至所有约束。此时，界面编辑器会根据视图的当前尺寸和位置推测出最佳约束。所以，小心摆放视图——即使是微小的间距差别，也可能造成截然不同的布局结果。

要让界面编辑器创建布局，点击解决问题工具，选择重置为推荐约束（Reset to Suggested Constraints）。随后，界面编辑器会为当前视图（或所有视图）添加约束，创建明确，可满足的布局。

我们也可以自行添加一部分约束，然后点击解决问题工具，选择添加缺失约束（Add Missing Constraints）。这个选项会为产生歧义的布局添加所需的约束，同样的，这个选项适用于当前视图或所有视图。

通过这种方式，我们可以快速创建明确，可满足的布局。不过，除非界面足够简单，否则结果可能会和我们预想的不同。所以，使用这种方式时，必须对洁面做足够的测试，以确保符合需求。

#### Finding and Editing Constraints（查找和编辑约束）

添加约束后，我们还要能够找到它，查看它，修改它。访问特定约束的方法有很多，每个都代表一种组织和呈现约束的方式。

##### Viewing Constraints in the Canvas（在画布中查看约束）

界面编辑器会在画布上显示影响当前视图的所有约束，具体表示为蓝色线条。线条的形状，头尾样式以及颜色能够告诉我们很多关于约束的信息。

- **T型直线（头尾为T型的直线）**。T型直线表示空间的尺寸。可以是视图宽高，也可以是两个视图之间的距离。
- **一般直线（头尾没有任何样式的直线）**。一般直线表示对齐方式。例如，对齐两个视图的前部时。当两个视图之间的间距为0pt时，也会用一般直线来表示。
- **实线**。实线表示优先级为"必要"的约束（1000）。
- **虚线**。虚线表示表示优先级小于1000的约束。
- **红线**。红线表示受此约束影响的某个元素，其布局有歧义，或无法满足，从而导致当前约束也无法满足。更多信息，可以通过左侧的问题导航面板或对象列表上方的查看箭头获取。
- **橙线**。橙线表示受此约束影响的元素的当前frame不正确。界面编辑器使用橙色虚线表示正确的frame。通过点击问题解决工具，选择更新frame（Update Frames），更新画布上元素的frame。
- **蓝线**。