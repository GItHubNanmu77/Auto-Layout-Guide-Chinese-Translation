# 翻译@Auto Layout Guide（自动布局指南）

- 原文：[Auto Layout Guide](https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/AutolayoutPG/index.html#//apple_ref/doc/uid/TP40010853)
- 作者：[Apple](https://developer.apple.com/library/content/navigation/)

---

## Debugging Auto Layout（Debug自动布局）

### Unsatisfiable Layouts（布局无法满足）

如果当前约束无解，则系统认为布局无法满足。这是因为两个或以上约束互相冲突，无满被同时满足。

#### Identifying Unsatisfiable Constraints（定位）

IB通常能够提早发现冲突，通过多种方式提醒开发者：

- 所有受影响约束用红色标记；
- 在左边的问题导航区域罗列出来；
- 文件列表右上方出现红色箭头；

![图59]()

点击箭头，当前布局的所有问题以列表形式给出。

IB还会为这些问题提供推荐的解决方案。更多信息，详见自动布局帮助中解决控制器，窗口和根视图布局问题相关的章节。

>注意
>
>尽管IB的即时反馈能极大减少布局出错的几率，但其无法涵盖所有布局错误。
>
>例如，IB仅基于当前画布尺寸侦测错误。不幸的是，某些冲突只有在画布尺寸（亦或是内容视图尺寸）大于或小于特定临界点时才会出现。IB对此无能为力。
>
>仅仅修复IB指出的错误是不够的。我们还需要在不同屏幕尺寸，方向，语言，动态字体下调试，以期发现可能的运行时错误。

一旦发生运行时错误，系统会执行以下操作：

1. 定位冲突约束；
2. 打破此约束，再次检测布局，重复这一动作，直至布局合法；
3. 向控制台输出冲突和被打破的约束的信息。

这种妥协机制在尽最大努力挽救布局的同时， 保证app得以正常运行。然而，打破布局所产生的后果无法预测。

有时，缺失这条约束并不会对布局效果产生影响；但有时，缺少这条约束会导致整套布局发生位置，缺失，甚至失踪。

如果一切安好，错误信息很容易被人忽略——毕竟app的实际使用体验未受影响。然而，任何对于视图结构的改变，或SDK的变化，都可能导致其他约束被打破，从而产生出人意料的布局效果。

因此，请修复已知的布局冲突。为了不遗漏任何错误，可以使用`UIViewAlertForUnsatisfiableConstraints`打断点，捕捉约束冲突。

#### Preventing Unsatisfiable Constraints（预防）

布局无法满足相对来说较容易修复。系统会指明冲突约束，并提供可能的解决方案。

一旦定位到错误，解决起来也就水到渠成。一般是移除其中一条约束，或者将其中一条改为可选约束。

然而，仍然有些问题值得探究：

- 代码创建视图，并将其加入视图结构，造成布局无法满足。

	默认，对于新创建的视图来说，其属性[translatesAutoresizingMaskIntoConstraints](https://developer.apple.com/documentation/uikit/uiview/1622572-translatesautoresizingmaskintoco)为`YES`。如果通过IB直接拖转视图到画布，则这个属性会自动置为NO。而通过代码创建视图时，需要手动将这个属性置为NO。
	
- 可用空间太小，造成布局无法满足。

	一般情况下开发者会对视图所在空间大小提前有所了解。然而，国际化和动态字体可能导致视图体积大于预期。可能的情况越多，越难保证布局不出错。
	
	我们可以采取妥协策略，如果某些条件无法达成，有组织，有预期的主动使布局失效。
	
	推荐的做法是将某些必要约束转化为高优先级可选约束。一旦发生冲突，这些约束将首先被打破。
	
	举例来说，我们将约束优先级设置为`999`。大多数情况下，这个约束同必要约束没有区别；然而，一旦发生冲突，其会被打破，保护布局中的其他约束。
	
	类似的，避免将具有固有尺寸的视图的外扩和内缩优先级设置为"必要"（1000），其默认值本身就是理想的妥协策略。视图或大或小，对布局没有实质影响。
	
	的确，有些视图总是应该以固有尺寸视人；即使如此，相较于布局失效，还不如允许这些视图在尺寸上有若干偏差。
	
	

